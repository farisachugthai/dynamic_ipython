
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>default_profile.startup.30_readline &#8212; Dynamic IPython: version0.0.2</title>
    
    <link rel="stylesheet" href="../../../_static/scrolls.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/theme_extras.js"></script>
    <link rel="canonical" href="https://farisachugthai.github.io/dynamic-ipython/_modules/default_profile/startup/30_readline.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<!-- <link charset="utf-8" href="https://fonts.googleapis.com/css?family=Source+Code+Pro" media="screen" rel="stylesheet" type="text/css" /> -->
<!-- <link charset="utf-8" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:regular,italic,bold,bolditalic" media="screen" rel="stylesheet" type="text/css" /> -->
<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>Floating label Demo</title>
  <meta name="description" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style type="text/css">
    /* CSS styles */
    /* Example by Matthias Benkort at http://codepen.io/KtorZ/pen/ZOzdqG */
    @import url(
      https://fonts.googleapis.com/css?family=Roboto:400,
      300,
      500,
      700
    );
    .wrapper {
      align-items: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .material-textfield {
      display: inline-block;
      height: 4rem;
      padding-top: 2rem;
    }
    .material-textfield input {
      background: none;
      border: none;
      box-sizing: border-box;
      display: block;
      font-family: Roboto, Arial, sans-serif;
      font-size: 1rem;
      padding: 0.25rem 0.1rem;
      width: 100%;
    }
    .material-textfield input:invalid {
      box-shadow: none;
    }
    .material-textfield input:focus {
      outline: none;
    }
    .material-textfield label {
      display: inline-block;
      font-family: Roboto, Arial, sans-serif;
      font-size: 0;
      pointer-events: none;
      position: relative;
      text-transform: uppercase;
      width: 100%;
    }
    .material-textfield label::before {
      content: attr(data-content);
      position: relative;
      transition: all 0.2s ease;
      will-change: font-size, top;
    }
    .material-textfield label::after {
      bottom: 0.9rem;
      content: "";
      height: 0.3rem;
      left: 50%;
      position: absolute;
      transition: all 0.2s ease;
      width: 0;
      will-change: width, left;
    }
    .material-textfield label::before,
    .material-textfield input[required]:focus ~ label::before {
      font-size: 0.75rem;
      top: -3.25rem;
    }
    .material-textfield input:focus ~ label::after {
      left: 0%;
      width: 100%;
    }
    .material-textfield input:invalid ~ label::before {
      font-size: 1rem;
      top: -2rem;
    }

    .material-textfield.blue input {
      border-bottom: 0.1rem solid #03a9f4;
      color: #0275a8;
    }
    .material-textfield.blue label::after {
      background: #03a9f4;
    }
    .material-textfield.blue label::before,
    .material-textfield.blue input[required]:focus ~ label::before {
      color: #47c4fd;
    }
    .material-textfield.blue input:invalid ~ label::before {
      color: #03a9f4;
    }

    .material-textfield.red input {
      border-bottom: 0.1rem solid #f44336;
      color: #d2190b;
    }
    .material-textfield.red label::after {
      background: #f44336;
    }
    .material-textfield.red label::before,
    .material-textfield.red input[required]:focus ~ label::before {
      color: #f8877f;
    }
    .material-textfield.red input:invalid ~ label::before {
      color: #f44336;
    }
  </style>
</head>

  </head><body> 
    <div id="content">
      <div class="header">
        <h1 class="heading"><a href="../../../index.html"
          title="back to the documentation overview"><span>default_profile.startup.30_readline</span></a></h1>
      </div>
      <div class="relnav" role="navigation" aria-label="related navigation">
        <a href="#">default_profile.startup.30_readline</a>
      </div>
      <div id="contentwrapper">
        <div role="main">
        
<h1>Source code for default_profile.startup.30_readline</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Module where readline is properly configured before prompt_toolkit is loaded.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">atexit</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">rlcompleter</span>
<span class="kn">from</span> <span class="nn">rlcompleter</span> <span class="kn">import</span> <span class="n">Completer</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="kn">from</span> <span class="nn">IPython.core.getipython</span> <span class="kn">import</span> <span class="n">get_ipython</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;IPYTHONDIR&quot;</span><span class="p">):</span>
    <span class="n">LOG_FILENAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;IPYTHONDIR&quot;</span><span class="p">),</span> <span class="s2">&quot;completer.log&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">LOG_FILENAME</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>


<div class="viewcode-block" id="SimpleCompleter"><a class="viewcode-back" href="../../../startup/setup_readline.html#default_profile.startup.30_readline.SimpleCompleter">[docs]</a><span class="k">class</span> <span class="nc">SimpleCompleter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Completion mechanism that tracks candidates for different subcommands.</span>

<span class="sd">    :URL: https://pymotw.com/3/readline/</span>

<span class="sd">    The SimpleCompleter class keeps a list of options that are candidates</span>
<span class="sd">    for auto-completion. The *complete* method for an instance is designed</span>
<span class="sd">    to be registered with `readline` as the source of completions.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SimpleCompleter.__init__"><a class="viewcode-back" href="../../../startup/setup_readline.html#default_profile.startup.30_readline.SimpleCompleter.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleCompleter.complete"><a class="viewcode-back" href="../../../startup/setup_readline.html#default_profile.startup.30_readline.SimpleCompleter.complete">[docs]</a>    <span class="k">def</span> <span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Complete a user&#39;s input.</span>

<span class="sd">        The arguments are a text string to complete and a state value,</span>
<span class="sd">        indicating how many times the function has been called with the</span>
<span class="sd">        same text.</span>

<span class="sd">        The function is called repeatedly with the state incremented</span>
<span class="sd">        each time. It should return a string if there is a candidate for that</span>
<span class="sd">        state value or None if there are no more candidates.</span>

<span class="sd">        The implementation of *complete* here looks for a set of</span>
<span class="sd">        matches when state is 0, and then returns all of the candidate matches</span>
<span class="sd">        one at a time on subsequent calls.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># This is the first time for this text,</span>
            <span class="c1"># so build a match list.</span>
            <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> matches: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[:]</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;(empty input) matches: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="p">)</span>

        <span class="c1"># Return the state&#39;th item from the match list,</span>
        <span class="c1"># if we have that many.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matches</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;complete(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">) =&gt; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">state</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">response</span></div></div>


<div class="viewcode-block" id="input_loop"><a class="viewcode-back" href="../../../startup/setup_readline.html#default_profile.startup.30_readline.input_loop">[docs]</a><span class="k">def</span> <span class="nf">input_loop</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Simulate a runnnig loop with a call to `input`.</span>

<span class="sd">    .. todo::</span>

<span class="sd">        Register the completer function.::</span>

<span class="sd">            OPTIONS = [&#39;start&#39;, &#39;stop&#39;, &#39;list&#39;, &#39;print&#39;]</span>
<span class="sd">            readline.set_completer(SimpleCompleter(OPTIONS).complete)</span>

<span class="sd">        Check what the API is to add a completer to ipython.</span>
<span class="sd">        I think it&#39;s |ip|\`.set_custom_completer`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">while</span> <span class="n">line</span> <span class="o">!=</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Prompt (&quot;stop&quot; to quit): &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dispatch </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">))</span></div>


<span class="c1"># Readline Config</span>


<div class="viewcode-block" id="readline_config"><a class="viewcode-back" href="../../../startup/setup_readline.html#default_profile.startup.30_readline.readline_config">[docs]</a><span class="k">def</span> <span class="nf">readline_config</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;The main point of execution for the readline configs.</span>

<span class="sd">    Should be cross-platform and independent of GNU readline or py readline.</span>

<span class="sd">    This sets up history where the history file is saved to and calls</span>
<span class="sd">    `atexit` with the `setup_historyfile` and `teardown_historyfile` functions</span>
<span class="sd">    as parameters.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s2">&quot;set show-all-if-ambiguous on&quot;</span><span class="p">)</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s2">&quot;TAB: menu-complete&quot;</span><span class="p">)</span>
    <span class="c1"># readline.parse_and_bind(&quot;CR: accept-line&quot;)</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\\</span><span class="s1">e[B&quot;: history-search-forward&#39;</span><span class="p">)</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\\</span><span class="s1">e[A&quot;: history-search-backward&#39;</span><span class="p">)</span>
    <span class="c1"># readline.parse_and_bind(&#39;&quot;\\C-d&quot;: end-of-file&#39;)</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\\</span><span class="s1">C-e&quot;: end-of-line&#39;</span><span class="p">)</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\\</span><span class="s1">C-h&quot;: backward-delete-char&#39;</span><span class="p">)</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\\</span><span class="s1">C-i&quot;: tab-insert&#39;</span><span class="p">)</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\\</span><span class="s1">C-j&quot;: accept-line&#39;</span><span class="p">)</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\\</span><span class="s1">C-k&quot;: &quot;kill-whole-line&quot;&#39;</span><span class="p">)</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\\</span><span class="s1">C-l&quot;: clear-screen&#39;</span><span class="p">)</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\\</span><span class="s1">C-m&quot;: accept-line&#39;</span><span class="p">)</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\\</span><span class="s1">C-n&quot;: complete&#39;</span><span class="p">)</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\\</span><span class="s1">C-r&quot;: reverse-search-history&#39;</span><span class="p">)</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\\</span><span class="s1">C-s&quot;: forward-search-history&#39;</span><span class="p">)</span>
    <span class="c1"># readline.parse_and_bind(&#39;&quot;\\C-p&quot;: &quot;history-search-backward&quot;&#39;),</span>
    <span class="c1"># readline.parse_and_bind(&#39;&quot;\\C-n&quot;: &quot;history-search-forward&quot;&#39;),</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\\</span><span class="s1">C-u&quot;: unix-line-discard&#39;</span><span class="p">)</span>

    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\\</span><span class="s1">C-w&quot;: unix-word-rubout&#39;</span><span class="p">)</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\\</span><span class="s1">C-]&quot;: character-search&#39;</span><span class="p">)</span>
    <span class="c1"># readline.parse_and_bind(&#39;&quot;\\e\C-]&quot;: character-search-backward&#39;)</span>
    <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s1">&#39;&quot;Insert&quot;: overwrite-mode&#39;</span><span class="p">)</span></div>
    <span class="c1"># readline.set_completer(Completer().complete)</span>


<div class="viewcode-block" id="py_readline"><a class="viewcode-back" href="../../../startup/setup_readline.html#default_profile.startup.30_readline.py_readline">[docs]</a><span class="k">def</span> <span class="nf">py_readline</span><span class="p">(</span><span class="n">rl</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Utilize the pyreadline API.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    :class:`pyreadline.rlmain.Readline`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Currently None. Seemingly works by modifying attributes on the instance</span>
<span class="sd">    and relying on side effects.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="c1"># This is actually really neat</span>
    <span class="n">rl</span><span class="o">.</span><span class="n">allow_ctrl_c</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">rl</span><span class="o">.</span><span class="n">command_color</span> <span class="o">=</span> <span class="s2">&quot;#7daea3&quot;</span>
    <span class="n">rl</span><span class="o">.</span><span class="n">read_init_file</span><span class="p">()</span>
    <span class="n">inputrc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;INPUTRC&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">inputrc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rl</span><span class="o">.</span><span class="n">read_inputrc</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/pyreadlineconfig.ini&quot;</span><span class="p">):</span>
        <span class="n">rl</span><span class="o">.</span><span class="n">read_inputrc</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/pyreadlineconfig.ini&quot;</span><span class="p">))</span></div>


<span class="c1"># History</span>


<div class="viewcode-block" id="setup_historyfile"><a class="viewcode-back" href="../../../startup/setup_readline.html#default_profile.startup.30_readline.setup_historyfile">[docs]</a><span class="k">def</span> <span class="nf">setup_historyfile</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add a history file to readline.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str, path, or `os.Pathlike`</span>
<span class="sd">        path to the history file. Internally converted to a `pathlib.Path`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;~/.python_history&quot;</span>
    <span class="n">histfile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">histfile</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">histfile</span><span class="o">.</span><span class="n">touch</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Could not create the history file.&quot;</span><span class="p">)</span>

    <span class="n">histfile_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">histfile</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">readline</span><span class="o">.</span><span class="n">read_history_file</span><span class="p">(</span><span class="n">histfile_str</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Could not read the history file.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">readline</span><span class="o">.</span><span class="n">set_history_length</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span></div>


<div class="viewcode-block" id="teardown_historyfile"><a class="viewcode-back" href="../../../startup/setup_readline.html#default_profile.startup.30_readline.teardown_historyfile">[docs]</a><span class="k">def</span> <span class="nf">teardown_historyfile</span><span class="p">(</span><span class="n">histfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">append_history_file</span><span class="p">(</span><span class="n">histfile</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;History not saved. There were problems saving to ~/.python_history&quot;</span>
        <span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># Interestingly this can work on Windows with a simple pip install pyreadline</span>
    <span class="c1"># however it can be imported as readline no alias so check it first</span>
    <span class="k">if</span> <span class="s2">&quot;pyreadline&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
        <span class="n">pyreadline</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;pyreadline&quot;</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">pyreadline.rlmain</span> <span class="kn">import</span> <span class="n">Readline</span>

        <span class="c1"># from pyreadline.lineobj.history import EscapeHistory, LineEditor</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="n">ModuleNotFoundError</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">readline</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">readline</span> <span class="kn">import</span> <span class="n">append_history_file</span>

            <span class="n">history_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/.python_history&quot;</span><span class="p">)</span>
            <span class="n">readline</span><span class="o">.</span><span class="n">read_history_file</span><span class="p">(</span><span class="n">history_file</span><span class="p">)</span>
            <span class="n">readline</span><span class="o">.</span><span class="n">set_history_length</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
            <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">append_history_file</span><span class="p">,</span> <span class="n">history_file</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># All the pyreadline submodules have to be called as pyreadline.</span>
        <span class="c1"># not all clases show up though, so they have to be called as readline</span>
        <span class="c1"># in that case</span>
        <span class="kn">from</span> <span class="nn">pyreadline.lineeditor.lineobj</span> <span class="kn">import</span> <span class="n">ReadLineTextBuffer</span>
        <span class="kn">from</span> <span class="nn">readline</span> <span class="kn">import</span> <span class="n">GetOutputFile</span>  <span class="c1"># output console via ctype</span>

        <span class="n">out_console</span> <span class="o">=</span> <span class="n">GetOutputFile</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">pyreadline.console.ansi</span> <span class="kn">import</span> <span class="n">AnsiState</span><span class="p">,</span> <span class="n">AnsiWriter</span>

        <span class="c1"># from pyreadline import append_history_file</span>
        <span class="n">readline</span> <span class="o">=</span> <span class="n">Readline</span><span class="p">()</span>
        <span class="n">py_readline</span><span class="p">(</span><span class="n">readline</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">pyreadline.modes.emacs</span> <span class="kn">import</span> <span class="n">EmacsMode</span>
        <span class="kn">from</span> <span class="nn">pyreadline.modes.vi</span> <span class="kn">import</span> <span class="n">ViMode</span>

        <span class="n">emacs_mode</span> <span class="o">=</span> <span class="n">EmacsMode</span><span class="p">(</span><span class="n">pyreadline</span><span class="o">.</span><span class="n">Readline</span><span class="p">())</span>
        <span class="n">vi_mode</span> <span class="o">=</span> <span class="n">ViMode</span><span class="p">(</span><span class="n">pyreadline</span><span class="o">.</span><span class="n">Readline</span><span class="p">())</span>
        <span class="n">history_file</span> <span class="o">=</span> <span class="s2">&quot;~/.python_history&quot;</span>
        <span class="n">setup_historyfile</span><span class="p">(</span><span class="n">history_file</span><span class="p">)</span>
        <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">readline</span><span class="o">.</span><span class="n">write_history_file</span><span class="p">)</span>

    <span class="n">readline_config</span><span class="p">()</span>
</pre></div>

        </div>
      </div>
    </div>

    <div class="footer" role="contentinfo">
      Last updated on Feb 18, 2020.
    </div>
  </body>
</html>