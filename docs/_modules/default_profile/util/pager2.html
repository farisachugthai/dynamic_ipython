
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>default_profile.util.pager2 &#8212; Dynamic IPython: version0.0.2</title>
    <link rel="stylesheet" href="../../../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <link rel="canonical" href="https://farisachugthai.github.io/dynamic-ipython/_modules/default_profile/util/pager2.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<link charset="utf-8" href="https://fonts.googleapis.com/css?family=Source+Code+Pro" media="screen" rel="stylesheet" type="text/css" />
<link charset="utf-8" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:regular,italic,bold,bolditalic" media="screen" rel="stylesheet" type="text/css" />
<link rel='stylesheet' href='//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.css'>
<!--[if lte IE 6]>
  <link
    rel="stylesheet"
    href="../../../_static/ie6.css"
    type="text/css"
    media="screen"
    charset="utf-8"
  />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Dynamic IPython</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
<h1>Source code for default_profile.util.pager2</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Rewrite the module that creates the ``%pycat`` magic.</span>

<span class="sd">In it&#39;s current implementation, the pager gives Windows a dumb terminal and</span>
<span class="sd">never checks for whether :command:`less` is on the :envvar:`PATH` or</span>
<span class="sd">if the user has a pager they wanna implement!</span>

<span class="sd">Working Implementation</span>
<span class="sd">----------------------</span>

<span class="sd">Oct 28, 2019:</span>

<span class="sd">Just ran this in the shell and I&#39;m really pleased with it.</span>

<span class="sd">It utilizes the :attr:`autocall` functionality of IPython, works with the</span>
<span class="sd">pycolorize utils, uses the page.page core function.</span>

<span class="sd">If the user doesn&#39;t provide an argument, then just show them the last input</span>
<span class="sd">they gave us especially since that var is **guaranteed** to always</span>
<span class="sd">be there.</span>

<span class="sd">Like solid shit man. And I came up with this in 10 minutes too!</span>

<span class="sd">.. testsetup::</span>

<span class="sd">    import IPython</span>
<span class="sd">    from IPython import get_ipython</span>
<span class="sd">    from IPython.core.magic import line_magic</span>

<span class="sd">.. ipython::</span>

<span class="sd">    In [105]: @line_magic</span>
<span class="sd">        ...: def p(shell=None, s=None):</span>
<span class="sd">        ...:     if shell is None:</span>
<span class="sd">        ...:         shell = get_ipython()</span>
<span class="sd">        ...:     if s is None:</span>
<span class="sd">        ...:         IPython.core.page.page(shell.pycolorize(_i))</span>
<span class="sd">        ...:     else:</span>
<span class="sd">        ...:         IPython.core.page.page(shell.pycolorize(shell.find_user_code(s, skip_encoding_cookie=True)))</span>

<span class="sd">    In [106]: /p</span>
<span class="sd">    @line_magic</span>
<span class="sd">    def p(shell=None, s=None):</span>
<span class="sd">        if shell is None:</span>
<span class="sd">            shell = get_ipython()</span>
<span class="sd">        if s is None:</span>
<span class="sd">            IPython.core.page.page(shell.pycolorize(_i))</span>
<span class="sd">        else:</span>
<span class="sd">            IPython.core.page.page(shell.pycolorize(shell.find_user_code(s, skip_encoding_cookie=True)))</span>


<span class="sd">.. todo:: Literally how is this the part that&#39;s giving me errors.</span>

<span class="sd">::</span>

<span class="sd">    PAGER_LOGGER = logging.getLogger(name=&#39;default_profile.util&#39;).getchild(&#39;pager2&#39;)</span>
<span class="sd">    PAGER_HANDLER = logging.StreamHandler()</span>
<span class="sd">    PAGER_LOGGER.addHandler(PAGER_HANDLER)</span>


<span class="sd">Original Pydoc Implementation and Errors</span>
<span class="sd">----------------------------------------</span>

<span class="sd">$ pydoc FRAMEOBJECTS</span>
<span class="sd">Traceback (most recent call last):</span>
<span class="sd">  File &quot;C:/tools/miniconda3/lib/runpy.py&quot;, line 193, in _run_module_as_main</span>
<span class="sd">    &quot;__main__&quot;, mod_spec)</span>
<span class="sd">  File &quot;C:/tools/miniconda3/lib/runpy.py&quot;, line 85, in _run_code</span>
<span class="sd">    exec(code, run_globals)</span>
<span class="sd">    elif request in self.topics: self.showtopic(request)</span>
<span class="sd">  File &quot;C:/tools/miniconda3/lib/pydoc.py&quot;, line 2021, in showtopic</span>
<span class="sd">    return self.showtopic(target, more_xrefs)</span>
<span class="sd">  File &quot;C:/tools/miniconda3/lib/pydoc.py&quot;, line 2037, in showtopic</span>
<span class="sd">    pager(doc)</span>
<span class="sd">  File &quot;C:/tools/miniconda3/lib/pydoc.py&quot;, line 1449, in pager</span>
<span class="sd">    pager(text)</span>
<span class="sd">  File &quot;C:/tools/miniconda3/lib/pydoc.py&quot;, line 1462, in &lt;lambda&gt;</span>
<span class="sd">    return lambda text: tempfilepager(plain(text), use_pager)</span>
<span class="sd">  File &quot;C:/tools/miniconda3/lib/pydoc.py&quot;, line 1519, in tempfilepager</span>
<span class="sd">    os.system(cmd + &#39; &quot;&#39; + filename + &#39;&quot;&#39;)</span>
<span class="sd">KeyboardInterrupt</span>


<span class="sd">Outside of the stupid traceback, that command worked perfectly for me.</span>

<span class="sd">I have $PAGER set on Windows {which I realize isn&#39;t typical}, however we should</span>
<span class="sd">re-use this implementation entirely and cut IPython.core.page.page out.</span>


<span class="sd">In [63]: pydoc.pipepager(inspect.getdoc(arg), os.environ.get(&#39;PAGER&#39;))</span>

<span class="sd">Despite the source code of the std lib stating that pipes are completely broken on windows,</span>
<span class="sd">this worked just fine for me.</span>

<span class="sd">Define arg as an object like if you pass a string it&#39;ll give you the help message</span>
<span class="sd">for a str.</span>

<span class="sd">:mod:`inspect` has a million more methods and pydoc does too so possibly change the</span>
<span class="sd">:func:`inspect.getdoc` part, but honestly that one line is 80% of the way</span>
<span class="sd">to what I&#39;ve been trying to do.</span>

<span class="sd">Nov 17, 2019:</span>

<span class="sd">Yo this is outrageous how inconsistently ANYTHING is working for me.</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">import_module</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">pydoc</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">IPython</span>
<span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">get_ipython</span>
<span class="kn">from</span> <span class="nn">IPython.core.error</span> <span class="kn">import</span> <span class="n">UsageError</span>
<span class="kn">from</span> <span class="nn">IPython.core.magic</span> <span class="kn">import</span> <span class="n">line_magic</span>
<span class="kn">from</span> <span class="nn">IPython.core.magics.namespace</span> <span class="kn">import</span> <span class="n">NamespaceMagics</span>
<span class="kn">from</span> <span class="nn">IPython.core.page</span> <span class="kn">import</span> <span class="n">pager_page</span>
<span class="c1"># from IPython.core.magics import</span>
<span class="c1"># Might need some of the funcs from IPython.utils.{PyColorize,coloransi,colorable}</span>


<div class="viewcode-block" id="NotInIPythonError"><a class="viewcode-back" href="../../../util/pager2.html#default_profile.util.pager2.NotInIPythonError">[docs]</a><span class="k">class</span> <span class="nc">NotInIPythonError</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Error raised when a magic is invoked outside of IPython.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="NotInIPythonError.__init__"><a class="viewcode-back" href="../../../util/pager2.html#default_profile.util.pager2.NotInIPythonError.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PyPager"><a class="viewcode-back" href="../../../util/pager2.html#default_profile.util.pager2.PyPager">[docs]</a><span class="k">class</span> <span class="nc">PyPager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A pager if you&#39;re outside of IPython.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PyPager.__init__"><a class="viewcode-back" href="../../../util/pager2.html#default_profile.util.pager2.PyPager.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;A pager for files you&#39;d like to inspect. Or interactive variables.&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">use_pager</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pydoc</span><span class="o">.</span><span class="n">tempfilepager</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">use_pager</span><span class="p">)</span>

<div class="viewcode-block" id="PyPager.call"><a class="viewcode-back" href="../../../util/pager2.html#default_profile.util.pager2.PyPager.call">[docs]</a>    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">use_pager</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">use_pager</span><span class="o">=</span><span class="n">use_pager</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="blocking_pager"><a class="viewcode-back" href="../../../util/pager2.html#default_profile.util.pager2.blocking_pager">[docs]</a><span class="k">def</span> <span class="nf">blocking_pager</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A pipe pager that works on Windows. Doesn&#39;t colorize anything.</span>

<span class="sd">    It&#39;s better that way though as we can send the contents elsewhere to</span>
<span class="sd">    be highlighted.</span>

<span class="sd">    Better to keep things separated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pydoc</span><span class="o">.</span><span class="n">pipepager</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s1">&#39;less -JRKMLige &#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="were_in_ipython"><a class="viewcode-back" href="../../../util/pager2.html#default_profile.util.pager2.were_in_ipython">[docs]</a><span class="k">def</span> <span class="nf">were_in_ipython</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Call ipython to make sure we&#39;re really in it.&quot;&quot;&quot;</span>
    <span class="n">shell</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">shell</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NotInIPythonError</span></div>
    <span class="c1"># (&#39;Not in IPython.&#39;)</span>


<div class="viewcode-block" id="provided_or_last"><a class="viewcode-back" href="../../../util/pager2.html#default_profile.util.pager2.provided_or_last">[docs]</a><span class="k">def</span> <span class="nf">provided_or_last</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Either run a provided code_cell from a user or rerun their last input.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">code_to_page</span> <span class="o">=</span> <span class="n">find_user_code</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">skip_encoding_cookie</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">code_to_page</span> <span class="o">=</span> <span class="n">_i</span>

    <span class="k">return</span> <span class="n">code_to_page</span></div>


<div class="viewcode-block" id="c"><a class="viewcode-back" href="../../../util/pager2.html#default_profile.util.pager2.c">[docs]</a><span class="nd">@line_magic</span>
<span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Intentionally abbreviated function call to `%pycat`.</span>

<span class="sd">    This implementation has the added benefit of wrapping everything in a</span>
<span class="sd">    try/except that catches KeyboardInterrupts and EOFErrors because pycat</span>
<span class="sd">    doesn&#39;t.</span>

<span class="sd">    .. note:: The internal variable namespace, or an instance of the magic</span>
<span class="sd">              :class:`~IPython.core.magics.namespace.NameSpaceMagics`</span>
<span class="sd">              can display the magics through the attribute ...magics.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : str</span>
<span class="sd">        String to page.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">were_in_ipython</span><span class="p">():</span>
        <span class="n">PyPager</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">provided_or_last</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">namespace</span> <span class="o">=</span> <span class="n">NamespaceMagics</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="s1">&#39;pycat&#39;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;pycat&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">):</span>
            <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s1">&#39;ya dun goofed&#39;</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">register_magic_function</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">c</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
    <h3>Quick search</h3>
    <div class="searchformwrapper">
        <form class="search" action="../../../search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
        </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>


<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a>
    <ul>
      <li><a href="../../index.html">Module code</a>
        <ul>
        </ul>
      </li>
    </ul>
</ul>
</li>


<h3><a href="../../../index.html">Table of Contents</a></h3>
<div>&nbsp;</div>
<div id="sidebartoc">
    <p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../sphinxext/index.html">Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../startup/index.html">IPython Startup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../util/index.html">IPython Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel.html">IPython Kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../jupyter/index.html">Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extensions.html">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../jobcontrol.html">Job Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../subcommands.html">Subcommands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev.html">Developers Notes</a></li>
</ul>

    
</div>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Dynamic IPython</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
      Last updated on Nov 24, 2019.
    </div>
  </body>
</html>