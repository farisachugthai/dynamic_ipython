
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>IPython Sphinx Directive &#8212; Dynamic IPython: version0.0.1</title>
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="canonical" href="https://farisachugthai.github.io/dynamic-ipython/sphinxext.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Developer‚Äôs Notes" href="dev.html" />
    <link rel="prev" title="Customized Exceptions" href="exceptions.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css"
  media="screen" charset="utf-8" />
<link rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css"
  media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dev.html" title="Developer‚Äôs Notes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="exceptions.html" title="Customized Exceptions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Dynamic IPython</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ipython-sphinx-directive">
<span id="ipython-directive"></span><h1>IPython Sphinx Directive<a class="headerlink" href="#ipython-sphinx-directive" title="Permalink to this headline">¬∂</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The IPython Sphinx Directive is in ‚Äòbeta‚Äô and currently under
active development. Improvements to the code or documentation are welcome!</p>
</div>
<p>The IPython directive is a stateful shell that can be useful for parsing
valid IPython code, auto-generating documentation based on the docstrings in
source code, and embedding plots based on live data in Sphinx documents.</p>
<p>The IPython Sphinx extension can correctly parse standard IPython prompts, and
extracts the input and output lines to generate HTML.
These prompts will be renumbered starting at <code class="docutils literal notranslate"><span class="pre">1</span></code> regardless of the actual
number displayed in the source code.</p>
<p>For example, code blocks like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">ipython</span><span class="p">::</span>

   <span class="n">In</span> <span class="p">[</span><span class="mi">136</span><span class="p">]:</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>

   <span class="n">In</span> <span class="p">[</span><span class="mi">137</span><span class="p">]:</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>
   <span class="n">Out</span><span class="p">[</span><span class="mi">137</span><span class="p">]:</span> <span class="mi">8</span>
</pre></div>
</div>
<p>will be rendered as</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>

<span class="gp">In [2]: </span><span class="n">x</span><span class="o">**</span><span class="mi">3</span>
<span class="go">8</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This tutorial should be read side-by-side with the Sphinx source
that generated this document.
With the exception of the example given above, the literal ReStructured
Text will not be displayed alongside the rendered output.</p>
</div>
<div class="section" id="persisting-the-session-across-ipython-directive-blocks">
<h2>Persisting the session across IPython directive blocks<a class="headerlink" href="#persisting-the-session-across-ipython-directive-blocks" title="Permalink to this headline">¬∂</a></h2>
<p>The state from previous code-blocks is stored, and carries over from section
to section. The IPython shell will maintain and continue to execute in the same
namespace so long as it remains in the same document.</p>
<p>This can be useful for documentation that may need to build on a few
lengthier examples rather than a handful of shorter snippets.</p>
<p>In addition, IPython‚Äôs output and <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.stderr" title="(in Python v3.7)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stderr</span></code></a> will be
inserted at doc build time and the prompts will be renumbered starting
from 1. For example, the prompt below is renumbered so as to follow the code
block from above.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span><span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="mi">3</span>   <span class="c1"># x is recalled from previous block</span>

<span class="gp">In [4]: </span><span class="n">z</span>
<span class="gh">Out[4]: </span><span class="go">6</span>

<span class="gp">In [5]: </span><span class="k">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="go">6</span>

<span class="gp">In [6]: </span><span class="n">q</span> <span class="o">=</span> <span class="n">z</span><span class="p">[)</span>   <span class="c1"># this is a syntax error -- we trap ipy exceptions</span>
<span class="gt">------------------------------------------------------------</span>
   <span class="n">File</span> <span class="s2">&quot;&lt;ipython console&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span>
     <span class="n">q</span> <span class="o">=</span> <span class="n">z</span><span class="p">[)</span>   <span class="c1"># this is a syntax error -- we trap ipy exceptions</span>
           <span class="o">^</span>
<span class="ne">SyntaxError</span>: invalid syntax
</pre></div>
</div>
</div>
<div class="section" id="multi-line-input">
<h2>Multi-line input<a class="headerlink" href="#multi-line-input" title="Permalink to this headline">¬∂</a></h2>
<p>Multi-line input is supported, and particularly lengthy blocks of text can be
parsed correctly.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://ichart.finance.yahoo.com/table.csv?s=CROX</span><span class="se">\</span>
<span class="gp">   ...: </span><span class="s1">&amp;d=9&amp;e=22&amp;f=2009&amp;g=d&amp;a=1&amp;br=8&amp;c=2006&amp;ignore=.csv&#39;</span>
<span class="gp">   ...: </span>

<span class="gp">In [8]: </span><span class="k">print</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">))</span>
<span class="go">[&#39;http://ichart.finance.yahoo.com/table.csv?s=CROX&#39;, &#39;d=9&#39;, &#39;e=22&#39;,</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-directive-outputs">
<h2>Testing directive outputs<a class="headerlink" href="#testing-directive-outputs" title="Permalink to this headline">¬∂</a></h2>
<p>The extension supports a few limited parameters to configure the running
shell. These parameters are exposed as reStructured text options to the
<code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">ipython</span></code> directive, decorators for the source code directly, and
configurable options that are given directly to Sphinx in a projects conf.py.</p>
<p>For example, you can put comments in your IPython sessions, which are
reported verbatim.  There are some handy ‚Äúpseudo-decorators‚Äù that let you
wrap a function with <code class="docutils literal notranslate"><span class="pre">&#64;doctest</span></code> and utilize the <a class="reference external" href="https://docs.python.org/3/library/doctest.html#module-doctest" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">doctest</span></code></a> module on
the output.</p>
<p>The inputs are fed to an embedded IPython session and the outputs are inserted into your documentation automatically.</p>
<p>If the output in your doc and the output from the embedded shell don‚Äôt
match on a <a class="reference external" href="https://docs.python.org/3/library/doctest.html#module-doctest" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">doctest</span></code></a> assertion, an error will occur.</p>
<p>If the <code class="xref py py-obj docutils literal notranslate"><span class="pre">&#64;doctest</span></code> decorator is found, it will take these steps when your
documentation is built:</p>
<ol class="arabic">
<li><p>Execute the <em>input</em> lines in your IPython directive block.</p></li>
<li><p>Compare the <em>output</em> of this with the output text that you‚Äôve put in the
IPython directive block (I.E. what comes after <code class="docutils literal notranslate"><span class="pre">Out[NN]</span></code>);</p></li>
<li><p>If there is a difference, the embedded shell will raise an error and
halt building the documentation.</p></li>
</ol>
<div class="admonition-warning-is-error admonition">
<p class="admonition-title">Warning is Error</p>
<p>All warnings are treated as errors in the default configuration which
will lead to frequent crashes while building documentation.
The option where this behavior can be modified, <code class="docutils literal notranslate"><span class="pre">ipython_warning_is_error</span></code>
is displayed in the <span class="xref std std-ref">IPython Sphinx directive module</span> section at the
bottom of the page.</p>
</div>
<p>You can <a class="reference external" href="https://docs.python.org/3/library/doctest.html#module-doctest" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">doctest</span></code></a> multi-line output as well. Just be careful
when using non-deterministic inputs like random numbers in the IPython
directive.</p>
<p>Because your inputs are run through a live interpreter, the random numbers
that are generated on the fly will likely differ from run to run.</p>
<p>Therefore the output IPython will compare the present run to will likely
differ, raising errors and causing mayhem.</p>
<p>How can we avoid this?</p>
<p>Here we ‚Äúseed‚Äù the random number generator for deterministic output, and
we suppress the seed line so it doesn‚Äôt show up in the rendered output.:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="kn">import</span> <span class="nn">numpy</span>
</pre></div>
</div>
<p>For more information on <code class="xref py py-obj docutils literal notranslate"><span class="pre">&#64;suppress</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">&#64;doctest</span></code> decorators, please refer
to the end of this file in <a class="reference internal" href="#pseudo-decorators"><span class="std std-ref">Supported Pseudo-Decorators</span></a> section.</p>
<div class="section" id="registering-your-own-doctest-handlers">
<h3>Registering Your Own Doctest Handlers<a class="headerlink" href="#registering-your-own-doctest-handlers" title="Permalink to this headline">¬∂</a></h3>
<p>The Sphinx extension that provides support for embedded IPython code provides
a pseudo-decorator <code class="xref py py-obj docutils literal notranslate"><span class="pre">&#64;doctest</span></code>, which treats the input/output block as a
doctest, raising a <code class="xref std std-keyword docutils literal notranslate"><span class="pre">RuntimeError</span></code> during doc generation if the actual output
(after running the input) does not match the expected output.</p>
<p>An example usage is:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">ipython</span><span class="p">::</span>

     In [1]: x = 1

     @doctest
     In [2]: x + 2
     Out[3]: 3
</pre></div>
</div>
<p>One can also provide arguments to the decorator. The first argument should be
the name of a custom handler. The specification of any other arguments is
determined by the handler. For example,</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">ipython</span><span class="p">::</span>

   @doctest float
   In [154]: 0.1 + 0.2
   Out[154]: 0.3
</pre></div>
</div>
<p>allows the actual output <code class="docutils literal notranslate"><span class="pre">0.30000000000000004</span></code> to match the expected output
due to a comparison with <code class="xref py py-obj docutils literal notranslate"><span class="pre">np.allclose</span></code>.</p>
<p>This is detailed in the module <a class="reference internal" href="#module-IPython.sphinxext.custom_doctests" title="IPython.sphinxext.custom_doctests"><code class="xref py py-mod docutils literal notranslate"><span class="pre">IPython.sphinxext.custom_doctests</span></code></a>.</p>
<p>Handlers should have the following function signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">handler</span><span class="p">(</span><span class="n">sphinx_shell</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">input_lines</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">submitted</span><span class="p">)</span>
</pre></div>
</div>
<dl class="glossary simple">
<dt id="term-sphinx-shell">sphinx_shell</dt><dd><p>Embedded Sphinx shell</p>
</dd>
<dt id="term-args">args</dt><dd><p>The list of arguments that follow <a class="reference external" href="mailto:'&#37;&#52;&#48;doctest">‚Äò<span>&#64;</span>doctest</a> handler_name‚Äô,</p>
</dd>
<dt id="term-input-lines">input_lines</dt><dd><p>A list of the lines relevant to the current doctest,</p>
</dd>
<dt id="term-found">found</dt><dd><p>A string containing the output from the IPython shell</p>
</dd>
<dt id="term-submitted">submitted</dt><dd><p>A string containing the expected output from the IPython shell.</p>
</dd>
</dl>
<p>Handlers must be registered in the <code class="xref py py-obj docutils literal notranslate"><span class="pre">doctests</span></code> dict at the end of the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">custom_doctests</span></code> module.</p>
<p>I quite honestly don‚Äôt know how you‚Äôre supposed to add handlers to the dict though.</p>
<p>But here‚Äôs the sauce:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># dict of allowable doctest handlers. The key represents the first argument</span>
<span class="c1"># that must be given to @doctest in order to activate the handler.</span>
<span class="n">doctests</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="n">float_doctest</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="directive-options">
<h3>Directive Options<a class="headerlink" href="#directive-options" title="Permalink to this headline">¬∂</a></h3>
<p>Another demonstration of multi-line input and output.:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">jdh</span>

<span class="gp">In [11]: </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">   ....: </span>
<span class="gp">   ....: </span>
<span class="go">0</span>
<span class="go">1</span>
<span class="go">2</span>
<span class="go">3</span>
<span class="go">4</span>
<span class="go">5</span>
<span class="go">6</span>
<span class="go">7</span>
<span class="go">8</span>
<span class="go">9</span>
</pre></div>
</div>
<p>Most of the ‚Äúpseudo-decorators‚Äù can be used as options to IPython
mode.  For example, to setup matplotlib‚Äôs <code class="docutils literal notranslate"><span class="pre">pylab</span></code> but suppress the
output, you can set things up in the following way.</p>
<p>When using the matplotlib <code class="docutils literal notranslate"><span class="pre">use</span></code> directive, it should
occur before any import of pylab.  This will not show up in the
rendered docs, but the commands will be executed in the embedded
interpreter and subsequent line numbers will be incremented to reflect
the inputs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">ipython</span><span class="p">::</span>
   <span class="p">:</span><span class="n">suppress</span><span class="p">:</span>

   <span class="n">In</span> <span class="p">[</span><span class="mi">144</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">matplotlib.pylab</span> <span class="k">import</span> <span class="o">*</span>

   <span class="n">In</span> <span class="p">[</span><span class="mi">145</span><span class="p">]:</span> <span class="n">ion</span><span class="p">()</span>
</pre></div>
</div>
<p>Likewise, you can set <code class="docutils literal notranslate"><span class="pre">:doctest:</span></code> or <code class="docutils literal notranslate"><span class="pre">:verbatim:</span></code> to apply these
settings to the entire block.  For example,</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [12]: </span><span class="n">cd</span> <span class="n">mpl</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span>
<span class="go">/home/jdhunter/mpl/examples</span>

<span class="gp">In [13]: </span><span class="n">pwd</span>
<span class="gh">Out[13]: </span><span class="go">&#39;/home/jdhunter/mpl/examples&#39;</span>

<span class="gp">In [14]: </span><span class="n">cd</span> <span class="n">mpl</span><span class="o">/</span><span class="n">examples</span><span class="o">/&lt;</span><span class="n">TAB</span><span class="o">&gt;</span>
<span class="go">mpl/examples/animation/        mpl/examples/misc/</span>
<span class="go">mpl/examples/api/              mpl/examples/mplot3d/</span>
<span class="go">mpl/examples/axes_grid/        mpl/examples/pylab_examples/</span>
<span class="go">mpl/examples/event_handling/   mpl/examples/widgets</span>

<span class="gp">In [15]: </span><span class="n">cd</span> <span class="n">mpl</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">widgets</span><span class="o">/</span>
<span class="go">/home/msierig/mpl/examples/widgets</span>

<span class="gp">In [16]: </span><span class="o">!</span>wc *
<span class="go">    2    12    77 README.txt</span>
<span class="go">   40    97   884 buttons.py</span>
<span class="go">   26    90   712 check_buttons.py</span>
<span class="go">   19    52   416 cursor.py</span>
<span class="go">  180   404  4882 menu.py</span>
<span class="go">   16    45   337 multicursor.py</span>
<span class="go">   36   106   916 radio_buttons.py</span>
<span class="go">   48   226  2082 rectangle_selector.py</span>
<span class="go">   43   118  1063 slider_demo.py</span>
<span class="go">   40   124  1088 span_selector.py</span>
<span class="go">  450  1274 12457 total</span>
</pre></div>
</div>
<p>You can create one or more pyplot plots and insert them with the
<code class="docutils literal notranslate"><span class="pre">&#64;savefig</span></code> decorator.</p>
<p>For more information on <code class="xref py py-obj docutils literal notranslate"><span class="pre">&#64;savefig</span></code> decorator, please refer to the end of this
page in <a class="reference internal" href="#pseudo-decorators"><span class="std std-ref">Supported Pseudo-Decorators</span></a> section.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]);</span>

<span class="go"># use a semicolon to suppress the output</span>
<span class="gp">In [18]: </span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span> <span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/plot_simple.png"><img alt="_images/plot_simple.png" src="_images/plot_simple.png" style="width: 4in;" /></a>
<a class="reference internal image-reference" href="_images/hist_simple.png"><img alt="_images/hist_simple.png" src="_images/hist_simple.png" style="width: 4in;" /></a>
<p>In a subsequent session, we can update the current figure with some
text, and then resave.:</p>
<pre class="literal-block">In [19]: ylabel('number')
Text(38.097222222222214, 0.5, 'number')

In [20]: title('normal distribution')
Text(0.5, 1, 'normal distribution')

In [21]: grid(True)</pre>
<a class="reference internal image-reference" href="_images/hist_with_text.png"><img alt="_images/hist_with_text.png" src="_images/hist_with_text.png" style="width: 4in;" /></a>
<p>You can also have function definitions included in the source.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [22]: </span><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="gp">   ....: </span><span class="sd">    An overcomplicated square function as an example.</span>
<span class="gp">   ....: </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">   ....: </span>    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="gp">   ....: </span>        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
<span class="gp">   ....: </span>    <span class="k">return</span> <span class="n">y</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>Then call it from a subsequent section.</p>
<pre class="literal-block">In [23]: square(3)
9

In [24]: square(-2)
4</pre>
<p><strong>Why does the sentence below appear no less than 3 times in this doc?</strong></p>
<p>For more information on the <code class="docutils literal notranslate"><span class="pre">&#64;doctest</span></code> decorator, please refer to the end of
this page in the <a class="reference internal" href="#pseudo-decorators"><span class="std std-ref">Supported Pseudo-Decorators</span></a> section.</p>
</div>
<div class="section" id="writing-pure-python-code">
<h3>Writing Pure Python Code<a class="headerlink" href="#writing-pure-python-code" title="Permalink to this headline">¬∂</a></h3>
<p>Pure python code is supported by the optional argument <code class="xref py py-obj docutils literal notranslate"><span class="pre">python</span></code>. In this
pure
python syntax you do not include the output from the python interpreter. The
following markup:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">ipython</span><span class="p">::</span> <span class="n">python</span>

   <span class="n">foo</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
   <span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
   <span class="n">foo</span> <span class="o">=</span> <span class="mi">2</span>
   <span class="n">foo</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
<p>Renders as</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [25]: </span><span class="n">foo</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>

<span class="gp">In [26]: </span><span class="k">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="go">bar</span>

<span class="gp">In [27]: </span><span class="n">foo</span> <span class="o">=</span> <span class="mi">2</span>

<span class="gp">In [28]: </span><span class="n">foo</span><span class="o">**</span><span class="mi">2</span>
<span class="go">4</span>
</pre></div>
</div>
<p>We can even plot from python, using the <code class="xref py py-obj docutils literal notranslate"><span class="pre">&#64;savefig</span></code> decorator, as well as
suppress output with a semicolon.:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [29]: </span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/plot_simple_python.png"><img alt="_images/plot_simple_python.png" src="_images/plot_simple_python.png" style="width: 4in;" /></a>
<p>For more information on <code class="docutils literal notranslate"><span class="pre">&#64;savefig</span></code> decorator,
please refer to the end of this page in Pseudo-Decorators section.</p>
<p>Similarly, <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.stderr" title="(in Python v3.7)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stderr</span></code></a> is inserted.:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [30]: </span><span class="n">foo</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>

<span class="gp">In [31]: </span><span class="n">foo</span><span class="p">[)</span>
<span class="go">[0;36m  File [0;32m&quot;&lt;ipython-input-31-edde7a2425af&gt;&quot;[0;36m, line [0;32m1[0m</span>
<span class="go">[0;31m    foo[)[0m</span>
<span class="go">[0m        ^[0m</span>
<span class="go">[0;31mSyntaxError[0m[0;31m:[0m invalid syntax</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="handling-comments">
<h2>Handling Comments<a class="headerlink" href="#handling-comments" title="Permalink to this headline">¬∂</a></h2>
<p>Comments are handled and state is preserved.:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># comments are handled</span>
<span class="gp">In [32]: </span><span class="k">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="go">bar</span>
</pre></div>
</div>
<p>The following section attempts to execute faulty code, namely the calling
the functions <code class="docutils literal notranslate"><span class="pre">ioff()</span></code> and <code class="docutils literal notranslate"><span class="pre">ion</span></code> which haven‚Äôt been defined.</p>
<p>If you don‚Äôt see the next code block then we can surmise that the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">&#64;suppress</span></code> decorator is behaving as expected.:</p>
</div>
<div class="section" id="splitting-python-statements-across-lines">
<h2>Splitting Python statements across lines<a class="headerlink" href="#splitting-python-statements-across-lines" title="Permalink to this headline">¬∂</a></h2>
<p>Multi-line input is handled.:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [33]: </span><span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;Multi</span><span class="se">\</span>
<span class="gp">   ....: </span><span class="s1">        line &amp;</span><span class="se">\</span>
<span class="gp">   ....: </span><span class="s1">        support &amp;</span><span class="se">\</span>
<span class="gp">   ....: </span><span class="s1">        works&#39;</span>
<span class="gp">   ....: </span>

<span class="gp">In [34]: </span><span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">))</span>
<span class="go">[&#39;Multi        line &#39;, &#39;        support &#39;, &#39;        works&#39;]</span>
</pre></div>
</div>
<p>Functions definitions are correctly parsed.:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [35]: </span><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="gp">   ....: </span><span class="sd">    An overcomplicated square function as an example.</span>
<span class="gp">   ....: </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">   ....: </span>    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="gp">   ....: </span>        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
<span class="gp">   ....: </span>    <span class="k">return</span> <span class="n">y</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>And persist across sessions.:</p>
<pre class="literal-block">In [36]: print(square(3))
9

In [37]: print(square(-2))
4</pre>
</div>
<div class="section" id="supported-pseudo-decorators">
<span id="pseudo-decorators"></span><h2>Supported Pseudo-Decorators<a class="headerlink" href="#supported-pseudo-decorators" title="Permalink to this headline">¬∂</a></h2>
<dl class="directive">
<dt id="directive-ipython">
<code class="sig-name descname">.. ipython::</code><a class="headerlink" href="#directive-ipython" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Create an IPython directive.</p>
<dl class="directive:option">
<dt id="directive:option-ipython-doctest">
<code class="sig-name descname">:doctest:</code><em class="property"> Run a doctest on IPython code blocks in rst.</em><a class="headerlink" href="#directive:option-ipython-doctest" title="Permalink to this definition">¬∂</a></dt>
<dd></dd></dl>

<dl class="directive:option">
<dt id="directive:option-ipython-python">
<code class="sig-name descname">:python:</code><a class="headerlink" href="#directive:option-ipython-python" title="Permalink to this definition">¬∂</a></dt>
<dd></dd></dl>

<dl class="directive:option">
<dt id="directive:option-ipython-okexcept">
<code class="sig-name descname">:okexcept:</code><a class="headerlink" href="#directive:option-ipython-okexcept" title="Permalink to this definition">¬∂</a></dt>
<dd></dd></dl>

<dl class="directive:option">
<dt id="directive:option-ipython-okwarning">
<code class="sig-name descname">:okwarning:</code><a class="headerlink" href="#directive:option-ipython-okwarning" title="Permalink to this definition">¬∂</a></dt>
<dd></dd></dl>

</dd></dl>

<p>The URL you need to build off of that directive is here:</p>
<p><a class="reference external" href="http://www.sphinx-doc.org/en/master/usage/restructuredtext/domains.html#the-restructuredtext-domain">http://www.sphinx-doc.org/en/master/usage/restructuredtext/domains.html#the-restructuredtext-domain</a></p>
<p>Here are the supported decorators, and any optional arguments they
take.  Some of the decorators can be used as options to the entire
block (e.g. <code class="docutils literal notranslate"><span class="pre">&#64;verbatim</span></code> and <code class="docutils literal notranslate"><span class="pre">&#64;suppress</span></code>), and some only apply to the
line just below them (eg <code class="docutils literal notranslate"><span class="pre">&#64;savefig</span></code>).:</p>
<dl class="glossary simple">
<dt id="term-suppress">&#64;suppress</dt><dd><p>Execute the IPython input block, but <em class="dfn">&#64;suppress</em> the input and output
block from the rendered output.  Also, can be applied to the entire
<code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">ipython</span></code> block as a directive option with <code class="docutils literal notranslate"><span class="pre">:suppress:</span></code>.</p>
</dd>
<dt id="term-verbatim">&#64;verbatim</dt><dd><p>Insert the input and output block in <em class="dfn">&#64;verbatim</em>, but auto-increment
the line numbers. Internally, the interpreter will be fed an empty
string, so it is a no-op that keeps line numbering consistent.
Also, can be applied to the entire <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">ipython</span></code> block as a
directive option with <code class="docutils literal notranslate"><span class="pre">:verbatim:</span></code>.</p>
</dd>
<dt id="term-savefig">&#64;savefig</dt><dd><p>Save the target of the directive to <em class="dfn">outfile</em>.
<em>I think I‚Äôm just gonna rewrite this entire paragraph.</em>
Save the figure to the static directory and insert it into the
document, possibly binding it into a mini-page and/or putting
code/figure label/references to associate the code and the figure.
Takes args to pass to the image directive (<em>scale</em>,
<em>width</em>, etc can be <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>)</p>
</dd>
<dt id="term-doctest">&#64;doctest</dt><dd><p>Compare the pasted in output in the IPython block with the output
generated at doc build time, and raise errors if they don‚Äôt
match. Also, can be applied to the entire <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">ipython</span></code> block as a
directive option with <code class="docutils literal notranslate"><span class="pre">:doctest:</span></code>.</p>
</dd>
</dl>
<div class="section" id="see-also">
<h3>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¬∂</a></h3>
<p><a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/directives.html#image">Image Options for rst directives from docutils</a> for details.</p>
</div>
</div>
<div class="section" id="module-IPython.sphinxext.ipython_directive">
<span id="automatically-generated-documentation"></span><h2>Automatically generated documentation<a class="headerlink" href="#module-IPython.sphinxext.ipython_directive" title="Permalink to this headline">¬∂</a></h2>
<p>Sphinx directive to support embedded IPython code.</p>
<p>IPython provides an extension for <a class="reference external" href="http://www.sphinx-doc.org/">Sphinx</a> to
highlight and run code.</p>
<p>This directive allows pasting of entire interactive IPython sessions, prompts
and all, and their code will actually get re-executed at doc build time, with
all prompts renumbered sequentially. It also allows you to input code as a pure
python input by giving the argument python to the directive. The output looks
like an interactive ipython section.</p>
<p>Here is an example of how the IPython directive can
<strong>run</strong> python code, at build time.</p>
<pre class="literal-block">In [1]: 1+1
2

In [2]: import datetime
   ...: datetime.datetime.now()
   ...: 
datetime.datetime(2019, 9, 16, 4, 27, 27, 354008)</pre>
<p>It supports IPython construct that plain
Python does not understand (like magics):</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span><span class="kn">import</span> <span class="nn">time</span>

<span class="gp">In [4]: </span><span class="o">%</span><span class="k">timeit</span> time.sleep(0.05)
<span class="go">50.4 ms +- 83 us per loop (mean +- std. dev. of 7 runs, 10 loops each)</span>
</pre></div>
</div>
<p>This will also support top-level async when using IPython 7.0+</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="gp">   ...: </span><span class="k">print</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
<span class="gp">   ...: </span><span class="n">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">   ...: </span><span class="k">print</span><span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">)</span>
<span class="gp">   ...: </span>
<span class="go">before</span>
<span class="go">after</span>
</pre></div>
</div>
<p>The namespace will persist across multiple code chucks, Let‚Äôs define a variable:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">who</span> <span class="o">=</span> <span class="s2">&quot;World&quot;</span>
</pre></div>
</div>
<p>And now say hello:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="k">print</span><span class="p">(</span><span class="s1">&#39;Hello,&#39;</span><span class="p">,</span> <span class="n">who</span><span class="p">)</span>
<span class="go">Hello, World</span>
</pre></div>
</div>
<p>If the current section raises an exception, you can add the <code class="docutils literal notranslate"><span class="pre">:okexcept:</span></code> flag
to the current block, otherwise the build will fail.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="go">[0;31m---------------------------------------------------------------------------[0m</span>
<span class="go">[0;31mZeroDivisionError[0m                         Traceback (most recent call last)</span>
<span class="go">[0;32m&lt;ipython-input-8-9e1622b385b6&gt;[0m in [0;36m&lt;module&gt;[0;34m[0m</span>
<span class="go">[0;32m----&gt; 1[0;31m [0;36m1[0m[0;34m/[0m[0;36m0[0m[0;34m[0m[0;34m[0m[0m</span>
<span class="go">[0m</span>
<span class="go">[0;31mZeroDivisionError[0m: division by zero</span>
</pre></div>
</div>
<div class="section" id="ipython-sphinx-directive-module">
<h3>IPython Sphinx directive module<a class="headerlink" href="#ipython-sphinx-directive-module" title="Permalink to this headline">¬∂</a></h3>
<p>To enable this directive, simply list it in your Sphinx <code class="docutils literal notranslate"><span class="pre">conf.py</span></code> file
(making sure the directory where you placed it is visible to sphinx, as is
needed for all Sphinx directives). For example, to enable syntax highlighting
and the IPython directive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;IPython.sphinxext.ipython_console_highlighting&#39;</span><span class="p">,</span>
              <span class="s1">&#39;IPython.sphinxext.ipython_directive&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The IPython directive outputs code-blocks with the language ‚Äòipython‚Äô. So
if you do not have the syntax highlighting extension enabled as well, then
all rendered code-blocks will be uncolored. By default this directive assumes
that your prompts are unchanged IPython ones, but this can be customized.
The configurable options that can be placed in conf.py are:</p>
<dl class="simple">
<dt>ipython_savefig_dir:</dt><dd><p>The directory in which to save the figures. This is relative to the
Sphinx source directory. The default is <code class="xref py py-obj docutils literal notranslate"><span class="pre">html_static_path</span></code>.</p>
</dd>
<dt>ipython_rgxin:</dt><dd><p>The compiled regular expression to denote the start of IPython input
lines. The default is <code class="docutils literal notranslate"><span class="pre">re.compile('In</span> <span class="pre">\[(\d+)\]:\s?(.*)\s*')</span></code>. You
shouldn‚Äôt need to change this.</p>
</dd>
<dt>ipython_warning_is_error: [default to True]</dt><dd><p>Fail the build if something unexpected happen, for example if a block raise
an exception but does not have the <code class="xref py py-obj docutils literal notranslate"><span class="pre">:okexcept:</span></code> flag. The exact behavior of
what is considered strict, may change between the sphinx directive version.</p>
</dd>
<dt>ipython_rgxout:</dt><dd><p>The compiled regular expression to denote the start of IPython output
lines. The default is <code class="docutils literal notranslate"><span class="pre">re.compile('Out\[(\d+)\]:\s?(.*)\s*')</span></code>. You
shouldn‚Äôt need to change this.</p>
</dd>
<dt>ipython_promptin:</dt><dd><p>The string to represent the IPython input prompt in the generated ReST.
The default is <code class="docutils literal notranslate"><span class="pre">'In</span> <span class="pre">[%d]:'</span></code>. This expects that the line numbers are used
in the prompt.</p>
</dd>
<dt>ipython_promptout:</dt><dd><p>The string to represent the IPython prompt in the generated ReST. The
default is <code class="docutils literal notranslate"><span class="pre">'Out</span> <span class="pre">[%d]:'</span></code>. This expects that the line numbers are used
in the prompt.</p>
</dd>
<dt>ipython_mplbackend:</dt><dd><p>The string which specifies if the embedded Sphinx shell should import
Matplotlib and set the backend. The value specifies a backend that is
passed to <code class="xref py py-obj docutils literal notranslate"><span class="pre">matplotlib.use()</span></code> before any lines in <code class="xref py py-obj docutils literal notranslate"><span class="pre">ipython_execlines</span></code> are
executed. If not specified in conf.py, then the default value of ‚Äòagg‚Äô is
used. To use the IPython directive without matplotlib as a dependency, set
the value to <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>. It may end up that matplotlib is still imported
if the user specifies so in <code class="xref py py-obj docutils literal notranslate"><span class="pre">ipython_execlines</span></code> or makes use of the
&#64;savefig pseudo decorator.</p>
</dd>
<dt>ipython_execlines:</dt><dd><p>A list of strings to be exec‚Äôd in the embedded Sphinx shell. Typical
usage is to make certain packages always available. Set this to an empty
list if you wish to have no imports always available. If specified in
<code class="docutils literal notranslate"><span class="pre">conf.py</span></code> as <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>, then it has the effect of making no imports available.
If omitted from conf.py altogether, then the default value of
[‚Äòimport numpy as np‚Äô, ‚Äòimport matplotlib.pyplot as plt‚Äô] is used.</p>
</dd>
<dt>ipython_holdcount</dt><dd><p>When the &#64;suppress pseudo-decorator is used, the execution count can be
incremented or not. The default behavior is to hold the execution count,
corresponding to a value of <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>. Set this to <a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a> to increment
the execution count after each suppressed command.</p>
</dd>
</dl>
<p>As an example, to use the IPython directive when <code class="xref py py-obj docutils literal notranslate"><span class="pre">matplotlib</span></code> is not available,
one sets the backend to <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipython_mplbackend</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<p>An example usage of the directive is:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">ipython</span><span class="p">::</span>

    In [1]: x = 1

    In [2]: y = x**2

    In [3]: print(y)
</pre></div>
</div>
<p>See <a class="reference external" href="http://matplotlib.org/sampledoc/ipython_directive.html">http://matplotlib.org/sampledoc/ipython_directive.html</a> for additional
documentation.</p>
<p>Note: Only one decorator is supported per input. If more than one decorator
is specified, then only the last one is used.</p>
<p>In addition to the Pseudo-Decorators/options described at the above link,
several enhancements have been made. The directive will emit a message to the
console at build-time if code-execution resulted in an exception or warning.
You can suppress these on a per-block basis by specifying the :okexcept:
or :okwarning: options:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">ipython</span><span class="p">::</span>
    <span class="nc">:okexcept:</span>
    <span class="nc">:okwarning:</span>

    In [1]: 1/0
    In [2]: # raise warning.
</pre></div>
</div>
<dl class="function">
<dt id="IPython.sphinxext.ipython_directive.block_parser">
<code class="sig-name descname">block_parser</code><span class="sig-paren">(</span><em class="sig-param">part</em>, <em class="sig-param">rgxin</em>, <em class="sig-param">rgxout</em>, <em class="sig-param">fmtin</em>, <em class="sig-param">fmtout</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/farisachugthai/dynamic_ipython/IPython/sphinxext/ipython_directive.py"><span class="viewcode-link">[source]</span></a><a class="reference internal" href="_modules/IPython/sphinxext/ipython_directive.html#block_parser"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IPython.sphinxext.ipython_directive.block_parser" title="Permalink to this definition">¬∂</a></dt>
<dd><p>part is a string of ipython text, comprised of at most one
input, one output, comments, and blank lines.  The block parser
parses the text into a list of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">TOKEN0</span><span class="p">,</span> <span class="n">data0</span><span class="p">),</span> <span class="p">(</span><span class="n">TOKEN1</span><span class="p">,</span> <span class="n">data1</span><span class="p">),</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>where TOKEN is one of [COMMENT | INPUT | OUTPUT ] and
data is, depending on the type of token:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">COMMENT</span> <span class="p">:</span> <span class="n">the</span> <span class="n">comment</span> <span class="n">string</span>

<span class="n">INPUT</span><span class="p">:</span> <span class="n">the</span> <span class="p">(</span><span class="n">DECORATOR</span><span class="p">,</span> <span class="n">INPUT_LINE</span><span class="p">,</span> <span class="n">REST</span><span class="p">)</span> <span class="n">where</span>
   <span class="n">DECORATOR</span><span class="p">:</span> <span class="n">the</span> <span class="nb">input</span> <span class="n">decorator</span> <span class="p">(</span><span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>
   <span class="n">INPUT_LINE</span><span class="p">:</span> <span class="n">the</span> <span class="nb">input</span> <span class="k">as</span> <span class="n">string</span> <span class="p">(</span><span class="n">possibly</span> <span class="n">multi</span><span class="o">-</span><span class="n">line</span><span class="p">)</span>
   <span class="n">REST</span> <span class="p">:</span> <span class="nb">any</span> <span class="n">stdout</span> <span class="n">generated</span> <span class="n">by</span> <span class="n">the</span> <span class="nb">input</span> <span class="n">line</span> <span class="p">(</span><span class="ow">not</span> <span class="n">OUTPUT</span><span class="p">)</span>

<span class="n">OUTPUT</span><span class="p">:</span> <span class="n">the</span> <span class="n">output</span> <span class="n">string</span><span class="p">,</span> <span class="n">possibly</span> <span class="n">multi</span><span class="o">-</span><span class="n">line</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="IPython.sphinxext.ipython_directive.EmbeddedSphinxShell">
<em class="property">class </em><code class="sig-name descname">EmbeddedSphinxShell</code><span class="sig-paren">(</span><em class="sig-param">exec_lines=None</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/farisachugthai/dynamic_ipython/IPython/sphinxext/ipython_directive.py"><span class="viewcode-link">[source]</span></a><a class="reference internal" href="_modules/IPython/sphinxext/ipython_directive.html#EmbeddedSphinxShell"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IPython.sphinxext.ipython_directive.EmbeddedSphinxShell" title="Permalink to this definition">¬∂</a></dt>
<dd><p>An embedded IPython instance to run inside Sphinx</p>
<dl class="method">
<dt id="IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.process_input_lines">
<code class="sig-name descname">process_input_lines</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">lines</em>, <em class="sig-param">store_history=True</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/farisachugthai/dynamic_ipython/IPython/sphinxext/ipython_directive.py"><span class="viewcode-link">[source]</span></a><a class="reference internal" href="_modules/IPython/sphinxext/ipython_directive.html#EmbeddedSphinxShell.process_input_lines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.process_input_lines" title="Permalink to this definition">¬∂</a></dt>
<dd><p>process the input, capturing stdout</p>
</dd></dl>

<dl class="method">
<dt id="IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.process_image">
<code class="sig-name descname">process_image</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">decorator</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/farisachugthai/dynamic_ipython/IPython/sphinxext/ipython_directive.py"><span class="viewcode-link">[source]</span></a><a class="reference internal" href="_modules/IPython/sphinxext/ipython_directive.html#EmbeddedSphinxShell.process_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.process_image" title="Permalink to this definition">¬∂</a></dt>
<dd><p># build out an image directive like
# .. image:: somefile.png
#    :width 4in
#
# from an input like
# savefig somefile.png width=4in</p>
</dd></dl>

<dl class="method">
<dt id="IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.process_input">
<code class="sig-name descname">process_input</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">data</em>, <em class="sig-param">input_prompt</em>, <em class="sig-param">lineno</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/farisachugthai/dynamic_ipython/IPython/sphinxext/ipython_directive.py"><span class="viewcode-link">[source]</span></a><a class="reference internal" href="_modules/IPython/sphinxext/ipython_directive.html#EmbeddedSphinxShell.process_input"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.process_input" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Process data block for INPUT token.</p>
</dd></dl>

<dl class="method">
<dt id="IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.process_output">
<code class="sig-name descname">process_output</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">data</em>, <em class="sig-param">output_prompt</em>, <em class="sig-param">input_lines</em>, <em class="sig-param">output</em>, <em class="sig-param">is_doctest</em>, <em class="sig-param">decorator</em>, <em class="sig-param">image_file</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/farisachugthai/dynamic_ipython/IPython/sphinxext/ipython_directive.py"><span class="viewcode-link">[source]</span></a><a class="reference internal" href="_modules/IPython/sphinxext/ipython_directive.html#EmbeddedSphinxShell.process_output"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.process_output" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Process data block for OUTPUT token.</p>
</dd></dl>

<dl class="method">
<dt id="IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.process_comment">
<code class="sig-name descname">process_comment</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">data</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/farisachugthai/dynamic_ipython/IPython/sphinxext/ipython_directive.py"><span class="viewcode-link">[source]</span></a><a class="reference internal" href="_modules/IPython/sphinxext/ipython_directive.html#EmbeddedSphinxShell.process_comment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.process_comment" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Process data fPblock for COMMENT token.</p>
</dd></dl>

<dl class="method">
<dt id="IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.save_image">
<code class="sig-name descname">save_image</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">image_file</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/farisachugthai/dynamic_ipython/IPython/sphinxext/ipython_directive.py"><span class="viewcode-link">[source]</span></a><a class="reference internal" href="_modules/IPython/sphinxext/ipython_directive.html#EmbeddedSphinxShell.save_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.save_image" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Saves the image file to disk.</p>
</dd></dl>

<dl class="method">
<dt id="IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.process_block">
<code class="sig-name descname">process_block</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">block</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/farisachugthai/dynamic_ipython/IPython/sphinxext/ipython_directive.py"><span class="viewcode-link">[source]</span></a><a class="reference internal" href="_modules/IPython/sphinxext/ipython_directive.html#EmbeddedSphinxShell.process_block"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.process_block" title="Permalink to this definition">¬∂</a></dt>
<dd><p>process block from the block_parser and return a list of processed lines</p>
</dd></dl>

<dl class="method">
<dt id="IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.ensure_pyplot">
<code class="sig-name descname">ensure_pyplot</code><span class="sig-paren">(</span><em class="sig-param">self</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/farisachugthai/dynamic_ipython/IPython/sphinxext/ipython_directive.py"><span class="viewcode-link">[source]</span></a><a class="reference internal" href="_modules/IPython/sphinxext/ipython_directive.html#EmbeddedSphinxShell.ensure_pyplot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.ensure_pyplot" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Ensures that pyplot has been imported into the embedded IPython shell.</p>
<p>Also, makes sure to set the backend appropriately if not set already.</p>
</dd></dl>

<dl class="method">
<dt id="IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.process_pure_python">
<code class="sig-name descname">process_pure_python</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">content</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/farisachugthai/dynamic_ipython/IPython/sphinxext/ipython_directive.py"><span class="viewcode-link">[source]</span></a><a class="reference internal" href="_modules/IPython/sphinxext/ipython_directive.html#EmbeddedSphinxShell.process_pure_python"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.process_pure_python" title="Permalink to this definition">¬∂</a></dt>
<dd><p>content is a list of strings. it is unedited directive content</p>
<p>This runs it line by line in the InteractiveShell, prepends
prompts as needed capturing stderr and stdout, then returns
the content as a list as if it were ipython code</p>
</dd></dl>

<dl class="method">
<dt id="IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.custom_doctest">
<code class="sig-name descname">custom_doctest</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">decorator</em>, <em class="sig-param">input_lines</em>, <em class="sig-param">found</em>, <em class="sig-param">submitted</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/farisachugthai/dynamic_ipython/IPython/sphinxext/ipython_directive.py"><span class="viewcode-link">[source]</span></a><a class="reference internal" href="_modules/IPython/sphinxext/ipython_directive.html#EmbeddedSphinxShell.custom_doctest"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IPython.sphinxext.ipython_directive.EmbeddedSphinxShell.custom_doctest" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Perform a specialized doctest.</p>
</dd></dl>

</dd></dl>

</div>
<span class="target" id="module-IPython.sphinxext.ipython_console_highlighting"></span><p>reST directive for syntax-highlighting ipython interactive sessions.</p>
<dl class="function">
<dt id="IPython.sphinxext.ipython_console_highlighting.setup">
<code class="sig-name descname">setup</code><span class="sig-paren">(</span><em class="sig-param">app</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/farisachugthai/dynamic_ipython/IPython/sphinxext/ipython_console_highlighting.py"><span class="viewcode-link">[source]</span></a><a class="reference internal" href="_modules/IPython/sphinxext/ipython_console_highlighting.html#setup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IPython.sphinxext.ipython_console_highlighting.setup" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Setup as a sphinx extension.</p>
</dd></dl>

<span class="target" id="module-IPython.sphinxext.custom_doctests"></span><p>Handlers for IPythonDirective‚Äôs &#64;doctest pseudo-decorator.</p>
<p>The Sphinx extension that provides support for embedded IPython code provides
a pseudo-decorator &#64;doctest, which treats the input/output block as a
doctest, raising a RuntimeError during doc generation if the actual output
(after running the input) does not match the expected output.</p>
<p>An example usage is:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">ipython</span><span class="p">::</span>

     In [1]: x = 1

     @doctest
     In [2]: x + 2
     Out[3]: 3
</pre></div>
</div>
<p>One can also provide arguments to the decorator. The first argument should be
the name of a custom handler. The specification of any other arguments is
determined by the handler. For example,</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">ipython</span><span class="p">::</span>

   @doctest float
   In [154]: 0.1 + 0.2
   Out[154]: 0.3
</pre></div>
</div>
<p>allows the actual output <code class="docutils literal notranslate"><span class="pre">0.30000000000000004</span></code> to match the expected output
due to a comparison with <code class="xref py py-obj docutils literal notranslate"><span class="pre">np.allclose</span></code>.</p>
<p>This module contains handlers for the &#64;doctest pseudo-decorator. Handlers
should have the following function signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">handler</span><span class="p">(</span><span class="n">sphinx_shell</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">input_lines</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">submitted</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="xref py py-obj docutils literal notranslate"><span class="pre">sphinx_shell</span></code> is the embedded Sphinx shell, <code class="xref py py-obj docutils literal notranslate"><span class="pre">args</span></code> contains the list
of arguments that follow: <a class="reference external" href="mailto:'&#37;&#52;&#48;doctest">‚Äò<span>&#64;</span>doctest</a> handler_name‚Äô, <code class="xref py py-obj docutils literal notranslate"><span class="pre">input_lines</span></code> contains
a list of the lines relevant to the current doctest, <code class="xref py py-obj docutils literal notranslate"><span class="pre">found</span></code> is a string
containing the output from the IPython shell, and <code class="xref py py-obj docutils literal notranslate"><span class="pre">submitted</span></code> is a string
containing the expected output from the IPython shell.</p>
<p>Handlers must be registered in the <code class="xref py py-obj docutils literal notranslate"><span class="pre">doctests</span></code> dict at the end of this module.</p>
<dl class="function">
<dt id="IPython.sphinxext.custom_doctests.str_to_array">
<code class="sig-name descname">str_to_array</code><span class="sig-paren">(</span><em class="sig-param">s</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/farisachugthai/dynamic_ipython/IPython/sphinxext/custom_doctests.py"><span class="viewcode-link">[source]</span></a><a class="reference internal" href="_modules/IPython/sphinxext/custom_doctests.html#str_to_array"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IPython.sphinxext.custom_doctests.str_to_array" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Simplistic converter of strings from repr to float NumPy arrays.</p>
<p>If the repr representation has ellipsis in it, then this will fail.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>s</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) ‚Äì The repr version of a NumPy array.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;array([ 0.3,  inf,  nan])&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">str_to_array</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="IPython.sphinxext.custom_doctests.float_doctest">
<code class="sig-name descname">float_doctest</code><span class="sig-paren">(</span><em class="sig-param">sphinx_shell</em>, <em class="sig-param">args</em>, <em class="sig-param">input_lines</em>, <em class="sig-param">found</em>, <em class="sig-param">submitted</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/farisachugthai/dynamic_ipython/IPython/sphinxext/custom_doctests.py"><span class="viewcode-link">[source]</span></a><a class="reference internal" href="_modules/IPython/sphinxext/custom_doctests.html#float_doctest"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IPython.sphinxext.custom_doctests.float_doctest" title="Permalink to this definition">¬∂</a></dt>
<dd><p>Doctest which allow the submitted output to vary slightly from the input.</p>
<p>Here is how it might appear in an rst file:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">ipython</span><span class="p">::</span>

   @doctest float
   In [1]: 0.1 + 0.2
   Out[1]: 0.3
</pre></div>
</div>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="exceptions.html" title="previous chapter">Customized Exceptions</a></li>
      <li>Next: <a href="dev.html" title="next chapter">Developer‚Äôs Notes</a></li>
  </ul></li>
</ul>

<h3><a href="index.html">Table of Contents</a></h3>

<div>&nbsp;</div>
<div id="sidebartoc">
    <p class="caption"><span class="caption-text">Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ipython_keybindings.html">Keybindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_magics.html">Custom Magics</a></li>
<li class="toctree-l1"><a class="reference internal" href="exceptions.html">Customized Exceptions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">IPython Sphinx Directive</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#persisting-the-session-across-ipython-directive-blocks">Persisting the session across IPython directive blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multi-line-input">Multi-line input</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-directive-outputs">Testing directive outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#handling-comments">Handling Comments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#splitting-python-statements-across-lines">Splitting Python statements across lines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-pseudo-decorators">Supported Pseudo-Decorators</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-IPython.sphinxext.ipython_directive">Automatically generated documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev.html">Developers Notes</a></li>
</ul>

</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/sphinxext.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dev.html" title="Developer‚Äôs Notes"
             >next</a> |</li>
        <li class="right" >
          <a href="exceptions.html" title="Customized Exceptions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Dynamic IPython</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
      Last updated on Sep 16, 2019.
    </div>
  </body>
</html>