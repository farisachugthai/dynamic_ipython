
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Custom Magics &#8212; Dynamic IPython: version0.0.1</title>
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="canonical" href="https://farisachugthai.github.io/dynamic-ipython/custom_magics.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Customized Exceptions" href="exceptions.html" />
    <link rel="prev" title="Built-In Magics" href="magics.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="exceptions.html" title="Customized Exceptions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="magics.html" title="Built-In Magics"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Dynamic IPython</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-custom-magics">
<span id="custom-magics"></span><h1>Custom Magics<a class="headerlink" href="#module-custom-magics" title="Permalink to this headline">¶</a></h1>
<p>The general flow of creating your own magic in a file breaks down to a few
simple steps.</p>
<ol class="arabic">
<li><p>Creating an executable with a function named <code class="docutils literal notranslate"><span class="pre">load_ipython_extension</span></code>.</p></li>
<li><p>Registering the magic with the IPython shell.</p></li>
<li><p>Wrapping it in decorators so that the magic accepts the shell as an argument
upon initialization.</p></li>
</ol>
<div class="section" id="registering-the-magic">
<h2>Registering the magic<a class="headerlink" href="#registering-the-magic" title="Permalink to this headline">¶</a></h2>
<p>There are 2 useful functions for registering a magic with the global IPython
instance.</p>
<p>The first is called <strong>register_magics</strong>.</p>
<div class="section" id="register-magics">
<h3><code class="docutils literal notranslate"><span class="pre">register_magics</span></code><a class="headerlink" href="#register-magics" title="Permalink to this headline">¶</a></h3>
<p>Signature: <code class="docutils literal notranslate"><span class="pre">register_magics(*magic_objects)</span></code></p>
<dl>
<dt>Docstring:</dt><dd><p>Register one or more instances of Magics.</p>
<p>Take one or more classes or instances of classes that subclass the main
<code class="xref py py-class docutils literal notranslate"><span class="pre">IPython.core.magic.Magic()</span></code> class, and register them with
IPython to use the magic functions they provide.</p>
<p>The registration process will then ensure that
any methods that have decorated to provide line and/or cell magics will
be recognized with the <code class="docutils literal notranslate"><span class="pre">%x</span></code>/<code class="docutils literal notranslate"><span class="pre">%%x</span></code> syntax as a line/cell magic
respectively.</p>
<p>If classes are given, they will be instantiated with the default
constructor.  If your classes need a custom constructor, you should
instantiate them first and pass the instance.</p>
<p>The provided arguments can be an arbitrary mix of classes and instances.</p>
</dd>
</dl>
<div class="section" id="register-magic-parameters">
<h4><code class="docutils literal notranslate"><span class="pre">register_magic</span></code> Parameters<a class="headerlink" href="#register-magic-parameters" title="Permalink to this headline">¶</a></h4>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">magic</span></code><span class="classifier">object</span></dt><dd><p>The decorated magic class or function.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="register-magic-function">
<h3><code class="docutils literal notranslate"><span class="pre">register_magic_function</span></code><a class="headerlink" href="#register-magic-function" title="Permalink to this headline">¶</a></h3>
<p>The first is the: <strong>register_magic_function</strong> bound to the <a class="reference external" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.core.interactiveshell.html#IPython.core.interactiveshell.InteractiveShell" title="(in IPython v7.8.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">IPython.core.interactiveshell.InteractiveShell</span></code></a> instance.</p>
<p>Signature: register_magic_function(func, magic_kind=’line’, magic_name=None)</p>
<p>Docstring:</p>
<div class="highlight-rst notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span>Expose a standalone function as magic function for IPython.

This will create an IPython magic (line, cell or both) from a
standalone function.  The functions should have the following
signatures:

    <span class="m">+</span> For line magics: <span class="nv">`def f(line)`</span>
    <span class="m">+</span> For cell magics: <span class="nv">`def f(line, cell)`</span>
    <span class="m">+</span> For a function that does both: <span class="nv">`def f(line, cell=None)`</span>

In the latter case, the function will be called with <span class="nv">`cell==None`</span> when
invoked as <span class="nv">`%f`</span>, and with cell as a string when invoked as <span class="nv">`%%f`</span>.
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="parameters">
<h3>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">func</span></code><span class="classifier">callable</span></dt><dd><p>Function to be registered as a magic.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">magic_kind</span></code><span class="classifier">str</span></dt><dd><p>Kind of magic, one of ‘line’, ‘cell’ or ‘line_cell’</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">magic_name</span></code><span class="classifier">str, optional</span></dt><dd><p>If given, the name the magic will have in the IPython namespace.  By
default, the name of the function itself is used.</p>
</dd>
</dl>
<p>This affords users the ability to create a magic, line or cell, out of
any function.</p>
</div>
<div class="section" id="tldr">
<h3>Tldr<a class="headerlink" href="#tldr" title="Permalink to this headline">¶</a></h3>
<p>Writing the extension:</p>
<ul>
<li><p>Import the global <a class="reference external" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.html#module-IPython" title="(in IPython v7.8.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">IPython</span></code></a> instance with:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">get_ipython</span>
</pre></div>
</div>
</li>
<li><p>Create an object with the global ipython app with:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">_ip</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
<p>If you want to try out your ipython magics you can do the following:</p>
<ul>
<li><p>Load your magic with:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">_ip</span><span class="o">.</span><span class="n">magic</span><span class="p">(</span><span class="s1">&#39;load_ext your_magic_name&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Run your magic with:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">_ip</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;your_magic_function&#39;</span><span class="p">,</span> <span class="s1">&#39;your_magic_arguments&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p><strong>(Optional)</strong>:</p>
<p>Access results of your magic with the <code class="docutils literal notranslate"><span class="pre">user_ns</span></code> attribute of <a class="reference external" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.core.interactiveshell.html#IPython.core.interactiveshell.InteractiveShell" title="(in IPython v7.8.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">IPython.core.interactiveshell.InteractiveShell</span></code></a>
in the IPython user namespace.</p>
<p>Admittedly I regularly flood my <code class="docutils literal notranslate"><span class="pre">user_ns</span></code> so this might not be viable in all
cases.</p>
<p>However in a testing situation this could prove beneficial.</p>
</div>
<div class="section" id="alternative-method-of-defining-magics-with-arguments">
<h3>Alternative Method of Defining Magics with Arguments<a class="headerlink" href="#alternative-method-of-defining-magics-with-arguments" title="Permalink to this headline">¶</a></h3>
<p>From the IPython team directly. The following is the module docstring for
<a class="reference external" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.core.magic_arguments.html#module-IPython.core.magic_arguments" title="(in IPython v7.8.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">IPython.core.magic_arguments</span></code></a>.</p>
<p>New magic functions can be defined like so:</p>
<div class="highlight-ipython notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.magic_arguments</span> <span class="kn">import</span> <span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="n">magic_arguments</span><span class="p">,</span>
    <span class="n">parse_argstring</span><span class="p">)</span>

<span class="nd">@magic_arguments</span><span class="p">()</span>
<span class="nd">@argument</span><span class="p">(</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;--option&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;An optional argument.&#39;</span><span class="p">)</span>
<span class="nd">@argument</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;An integer positional argument.&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">magic_cool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A really cool magic command.</span>

<span class="sd">&quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_argstring</span><span class="p">(</span><span class="n">magic_cool</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The <code class="xref py py-obj docutils literal notranslate"><span class="pre">&#64;magic_arguments</span></code> decorator marks the function as having
<a class="reference external" href="https://docs.python.org/3/library/argparse.html#module-argparse" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> arguments.</p>
<p>The <code class="xref py py-obj docutils literal notranslate"><span class="pre">&#64;argument</span></code> decorator adds an argument using the same syntax as
<a class="reference external" href="https://docs.python.org/3/library/argparse.html#module-argparse" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a>’s <code class="xref py py-obj docutils literal notranslate"><span class="pre">add_argument()</span></code> method.</p>
<p>More sophisticated uses may also require the <code class="xref py py-obj docutils literal notranslate"><span class="pre">&#64;argument_group</span></code> or
<code class="xref py py-obj docutils literal notranslate"><span class="pre">&#64;kwds</span></code> decorator to customize the formatting and the parsing.</p>
<p>Help text for the magic is automatically generated from the docstring and the
arguments</p>
<div class="highlight-none notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span>In[1]: %cool?
       %cool [-o OPTION] arg

       A really cool magic command.

       positional arguments:
         arg                   An integer positional argument.

       optional arguments:
         -o OPTION, --option OPTION      An optional argument.
</pre></div>
</td></tr></table></div>
<p>Inheritance diagram:</p>
</div>
<div class="section" id="writing-custom-magics">
<span id="extensions-and-custom-magics"></span><h3>Writing Custom Magics<a class="headerlink" href="#writing-custom-magics" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://raw.githubusercontent.com/ipython/ipython/523ed2fe58ea5ee9971d2b21df1de33b8cdfa924/docs/source/config/custommagics.rst">Custom Magics</a>:</p>
<p>There are two main ways to define your own magic functions. From standalone
functions and by inheriting from a base class provided by <a class="reference external" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.html#module-IPython" title="(in IPython v7.8.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">IPython</span></code></a>:</p>
<p><a class="reference external" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.core.magic.html#IPython.core.magic.Magics" title="(in IPython v7.8.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">IPython.core.magic.Magics</span></code></a></p>
<p>Below, there will be code displayed that demonstrates how to write an extension
and allow it to be automatically loaded.</p>
<p>Start by changing to IPython’s startup directory. This can be found as the
<a class="reference external" href="../../default_profile/startup">startup</a> subdirectory of your default
IPython profile.</p>
<p>First, let us see the simplest case. The following shows how to create a line
magic, a cell one and one that works in both modes, using just plain functions:</p>
<div class="highlight-ipython notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">IPython.core.magic</span> <span class="kn">import</span> <span class="p">(</span><span class="n">register_line_magic</span><span class="p">,</span> <span class="n">register_cell_magic</span><span class="p">,</span>
<span class="gp">   ...: </span>                                <span class="n">register_line_cell_magic</span><span class="p">)</span>
<span class="gp">   ...: </span>

<span class="gp">In [2]: </span><span class="k">def</span> <span class="nf">lmagic</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;my line magic&quot;</span>
<span class="gp">   ...: </span>    <span class="k">return</span> <span class="n">line</span>
<span class="gp">   ...: </span>

<span class="gp">In [3]: </span><span class="k">def</span> <span class="nf">cmagic</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">cell</span><span class="p">):</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;my cell magic&quot;</span>
<span class="gp">   ...: </span>    <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">cell</span>
<span class="gp">   ...: </span>

<span class="gp">In [4]: </span><span class="k">def</span> <span class="nf">lcmagic</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;Magic that works both as </span><span class="si">%lc</span><span class="s2">magic and as </span><span class="si">%%</span><span class="s2">lcmagic&quot;</span>
<span class="gp">   ...: </span>    <span class="k">if</span> <span class="n">cell</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<span class="gp">   ...: </span>        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Called as line magic&quot;</span><span class="p">)</span>
<span class="gp">   ...: </span>        <span class="k">return</span> <span class="n">line</span>
<span class="gp">   ...: </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">   ...: </span>        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Called as cell magic&quot;</span><span class="p">)</span>
<span class="gp">   ...: </span>        <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">cell</span>
<span class="gp">   ...: </span>
</pre></div>
</td></tr></table></div>
<p>You can also create magics of all three kinds by inheriting from the
<a class="reference external" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.core.magic.html#IPython.core.magic.Magics" title="(in IPython v7.8.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">IPython.core.magic.Magics</span></code></a> class.</p>
<p>This lets you create magics that can potentially hold state in between
calls, and that have full access to the main IPython object:</p>
<p>This code can be put in any Python module, it does not require IPython
itself to be running already.  It only creates the magics subclass but
doesn’t instantiate it yet.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The class MUST call this class decorator at creation time</p>
</div>
<div class="highlight-ipython notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="gp">In [6]: </span><span class="kn">from</span> <span class="nn">IPython.core.magic</span> <span class="kn">import</span> <span class="n">Magics</span><span class="p">,</span> <span class="n">magics_class</span><span class="p">,</span> <span class="n">line_magic</span>

<span class="gp">In [7]: </span><span class="kn">from</span> <span class="nn">IPython.core.magic</span> <span class="kn">import</span> <span class="n">cell_magic</span><span class="p">,</span> <span class="n">line_cell_magic</span>

<span class="gp">In [8]: </span><span class="k">class</span> <span class="nc">MyMagics</span><span class="p">(</span><span class="n">Magics</span><span class="p">):</span>
<span class="gp">   ...: </span>    <span class="k">def</span> <span class="nf">lmagic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
<span class="gp">   ...: </span>        <span class="sd">&quot;&quot;&quot;My line magic.&quot;&quot;&quot;</span>
<span class="gp">   ...: </span>        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Full access to the main IPython object:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell</span><span class="p">)</span>
<span class="gp">   ...: </span>        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Variables in the user namespace:&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">user_ns</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="gp">   ...: </span>        <span class="k">return</span> <span class="n">line</span>
<span class="gp">   ...: </span>

<span class="gp">In [9]: </span><span class="k">def</span> <span class="nf">cmagic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">cell</span><span class="p">):</span>
<span class="gp">   ...: </span>        <span class="sd">&quot;&quot;&quot;My cell magic.&quot;&quot;&quot;</span>
<span class="gp">   ...: </span>        <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">cell</span>
<span class="gp">   ...: </span>
</pre></div>
</td></tr></table></div>
<p>In order to actually use these magics, you must register them with a
running IPython instance.</p>
<p>Any module file that define a function named <code class="docutils literal notranslate"><span class="pre">load_ipython_extension</span></code>
can be loaded via <code class="xref py py-obj docutils literal notranslate"><span class="pre">%load_ext</span></code> module.path or be configured to be
autoloaded by IPython at startup time.</p>
<p>You can register the class itself without instantiating it.  IPython will
call the default constructor on it.:</p>
<div class="highlight-ipython notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">get_ipython</span>

<span class="n">shell</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">load_ipython_extension</span><span class="p">(</span><span class="n">shell</span><span class="p">):</span>
    <span class="n">shell</span><span class="o">.</span><span class="n">register_magics</span><span class="p">(</span><span class="n">MyMagics</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>If you want to create a class with a different constructor that holds
additional state, then you should always call the parent constructor and
instantiate the class yourself before registration:</p>
<div class="highlight-ipython notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="kn">from</span> <span class="nn">IPython.core.magic</span> <span class="kn">import</span> <span class="n">Magics</span><span class="p">,</span> <span class="n">magics_class</span><span class="p">,</span> <span class="n">line_magic</span>

<span class="gp">In [11]: </span><span class="kn">from</span> <span class="nn">IPython.core.magic</span> <span class="kn">import</span> <span class="n">cell_magic</span><span class="p">,</span> <span class="n">line_cell_magic</span>

<span class="gp">In [12]: </span><span class="k">class</span> <span class="nc">StatefulMagics</span><span class="p">(</span><span class="n">Magics</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="s2">&quot;Magics that hold additional state&quot;</span>
<span class="gp">   ....: </span>

<span class="gp">In [13]: </span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shell</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="gp">   ....: </span>        <span class="nb">super</span><span class="p">(</span><span class="n">StatefulMagics</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">shell</span><span class="p">)</span>
<span class="gp">   ....: </span>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
<span class="gp">   ....: </span>

<span class="go">    # This class must then be registered with a manually created instance,</span>
<span class="go">    # since its constructor has different arguments from the default:</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>pre 0.12 IPython API change</p>
<p>In early IPython versions 0.12 and before the line magics were
created using a <code class="xref py py-func docutils literal notranslate"><span class="pre">define_magic()</span></code> API function.  This API has been
replaced with the above in IPython 0.13 and then completely removed
in IPython 5.  Maintainers of IPython extensions that still use the
<code class="xref py py-func docutils literal notranslate"><span class="pre">define_magic()</span></code> function are advised to adjust their code
for the current API.</p>
</div>
</div>
</div>
<div class="section" id="complete-example">
<h2>Complete Example<a class="headerlink" href="#complete-example" title="Permalink to this headline">¶</a></h2>
<p>Here is a full example of a magic package. You can distribute magics using
setuptools, distutils, or any other distribution tools like <a class="reference external" href="http://flit.readthedocs.io">flit</a> for pure Python packages.</p>
<div class="highlight-none notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>.
├── example_magic
│   ├── __init__.py
│   └── abracadabra.py
└── setup.py
</pre></div>
</td></tr></table></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cat example_magic/__init__.py
</pre></div>
</div>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;An example magic&quot;&quot;&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.0.1&#39;</span>

<span class="kn">from</span> <span class="nn">.abracadabra</span> <span class="k">import</span> <span class="n">Abracadabra</span>

<span class="k">def</span> <span class="nf">load_ipython_extension</span><span class="p">(</span><span class="n">_ip</span><span class="p">):</span>
    <span class="n">ipython</span><span class="o">.</span><span class="n">register_magics</span><span class="p">(</span><span class="n">Abracadabra</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cat example_magic/abracadabra.py
</pre></div>
</div>
<div class="highlight-python3 notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.magic</span> <span class="k">import</span> <span class="p">(</span><span class="n">Magics</span><span class="p">,</span> <span class="n">magics_class</span><span class="p">,</span> <span class="n">line_magic</span><span class="p">,</span> <span class="n">cell_magic</span><span class="p">)</span>

<span class="nd">@magics_class</span>
<span class="k">class</span> <span class="nc">Abracadabra</span><span class="p">(</span><span class="n">Magics</span><span class="p">):</span>

    <span class="nd">@line_magic</span>
    <span class="k">def</span> <span class="nf">abra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">line</span>

    <span class="nd">@cell_magic</span>
    <span class="k">def</span> <span class="nf">cadabra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">cell</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">cell</span>
</pre></div>
</td></tr></table></div>
<p>To round this out, we’ll finish with an example from Cyrille Rossant.</p>
</div>
<div class="section" id="creating-ipython-extensions">
<h2>Creating IPython Extensions<a class="headerlink" href="#creating-ipython-extensions" title="Permalink to this headline">¶</a></h2>
<p><em>Summarized from “Learning IPython for Interactive Computing and Data
Visualization 1st ed.pdf”</em>:</p>
<blockquote>
<div><p>To create an extension, we need to create a Python module in a
directory, which is in the Python path. A possibility is to put it in
the current directory, or in your <a class="reference external" href="../../extensions">IPython extensions dir</a></p>
<p>An extension implements a function load_ipython_extension.
<code class="xref py py-func docutils literal notranslate"><span class="pre">IPython.core.magics.extension.load_ipython_extension(ipython)()</span></code>,
takes the current <a class="reference external" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.core.interactiveshell.html#IPython.core.interactiveshell.InteractiveShell" title="(in IPython v7.8.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">IPython.core.interactiveshell.InteractiveShell</span></code></a> instance as an argument (and possibly
<code class="xref py py-func docutils literal notranslate"><span class="pre">IPython.core.magics.extension.unload_ipython_extension(ipython)()</span></code>,
which is called when the extension is unloaded). This instance can be
used to register new magic commands, access the user namespace, execute
code, and so on.
This loading function is called when the extension is loaded, which
happens when the command is executed.</p>
</div></blockquote>
<p>To automatically load a module when <a class="reference external" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.html#module-IPython" title="(in IPython v7.8.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">IPython</span></code></a> starts,
we need to add the module name to the <code class="docutils literal notranslate"><span class="pre">c.TerminalIPythonApp.extensions</span></code>
list in the <a class="reference external" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.html#module-IPython" title="(in IPython v7.8.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">IPython</span></code></a> configuration file.</p>
<p>The <a class="reference external" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.core.interactiveshell.html#IPython.core.interactiveshell.InteractiveShell" title="(in IPython v7.8.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">IPython.core.interactiveshell.InteractiveShell</span></code></a> instance represents the active
IPython interpreter. Useful methods and attributes include
<code class="xref py py-func docutils literal notranslate"><span class="pre">IPython.core.magic.register_magics()</span></code>, to create new magic commands,
and <code class="docutils literal notranslate"><span class="pre">user_ns</span></code>, to access the user namespace. You can
explore all the instance’s attributes interactively from
<a class="reference external" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.html#module-IPython" title="(in IPython v7.8.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">IPython</span></code></a> with tab completion. For that, you need to execute
the following command to get the current instance</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="magics.html" title="previous chapter">Built-In Magics</a></li>
      <li>Next: <a href="exceptions.html" title="next chapter">Customized Exceptions</a></li>
  </ul></li>
</ul>

<h3><a href="index.html">Table of Contents</a></h3>

<div>&nbsp;</div>
<div id="sidebartoc">
    <p class="caption"><span class="caption-text">Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ipython_keybindings.html">Keybindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="magics.html">Built-in Magics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Writing Your Own Magics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#registering-the-magic">Registering the magic</a></li>
<li class="toctree-l2"><a class="reference internal" href="#complete-example">Complete Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-ipython-extensions">Creating IPython Extensions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="exceptions.html">Customized Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="sphinxext.html">IPython Sphinx Directive</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev.html">Developers Notes</a></li>
</ul>
<p class="caption"><span class="caption-text">API Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="startup/index.html">IPython Shell Initialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="jupyter.html">Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="extensions.html">Extensions</a></li>
</ul>

</div>

<h3><a href="index.html">On This Page:</a></h3>

<div>&nbsp;</div>
<div id="sidebartoc">
  <ul>
<li><a class="reference internal" href="#">Custom Magics</a><ul>
<li><a class="reference internal" href="#registering-the-magic">Registering the magic</a><ul>
<li><a class="reference internal" href="#register-magics"><code class="docutils literal notranslate"><span class="pre">register_magics</span></code></a><ul>
<li><a class="reference internal" href="#register-magic-parameters"><code class="docutils literal notranslate"><span class="pre">register_magic</span></code> Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#register-magic-function"><code class="docutils literal notranslate"><span class="pre">register_magic_function</span></code></a></li>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#tldr">Tldr</a></li>
<li><a class="reference internal" href="#alternative-method-of-defining-magics-with-arguments">Alternative Method of Defining Magics with Arguments</a></li>
<li><a class="reference internal" href="#writing-custom-magics">Writing Custom Magics</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complete-example">Complete Example</a></li>
<li><a class="reference internal" href="#creating-ipython-extensions">Creating IPython Extensions</a></li>
</ul>
</li>
</ul>

</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/custom_magics.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="exceptions.html" title="Customized Exceptions"
             >next</a> |</li>
        <li class="right" >
          <a href="magics.html" title="Built-In Magics"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Dynamic IPython</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright (C) 2018-2019 Faris Chugthai.
      Last updated on Sep 02, 2019.
    </div>
  </body>
</html>